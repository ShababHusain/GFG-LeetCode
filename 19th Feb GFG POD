class Solution {
    public ArrayList<Integer> missingRange(int[] arr, int low, int high) {
        ArrayList<Integer> result = new ArrayList<>();
        if (low > high) return result;

        long rangeSizeLong = (long) high - (long) low + 1L;
        // Heuristic guard to avoid huge memory allocation for boolean array
        if (rangeSizeLong <= 2_000_000L) {
            int rangeSize = (int) rangeSizeLong;
            boolean[] present = new boolean[rangeSize];
            if (arr != null) {
                for (int v : arr) {
                    if (v >= low && v <= high) present[v - low] = true;
                }
            }
            for (int i = 0; i < rangeSize; i++) {
                if (!present[i]) result.add(low + i);
            }
            return result;
        }

        // Fallback for very large ranges: use HashSet
        HashSet<Integer> set = new HashSet<>();
        if (arr != null) {
            for (int v : arr) {
                if (v >= low && v <= high) set.add(v);
            }
        }
        for (int x = low; x <= high; x++) {
            if (!set.contains(x)) result.add(x);
        }
        return result;
    }
}
